<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>YouTube Player</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      height: 100%;
      overflow: hidden;
    }
    iframe {
      width: 100%;
      height: 100%;
      border: 0;
      display: block;
    }
    .error {
      padding: 18px;
      font-size: 14px;
      color: #9bd0ff;
      line-height: 1.5;
      font-family: Arial, system-ui, -apple-system, Segoe UI, Roboto;
    }
    a { color: #9bd0ff; }
  </style>
</head>

<body>
  <iframe id="ytFrame" allowfullscreen></iframe>
  <div class="error" id="err" style="display:none;"></div>

<script>
  function getInt(v, d = 0) {
    const n = parseInt(v ?? "", 10);
    return Number.isFinite(n) ? n : d;
  }

  const params = new URLSearchParams(location.search);

  let videoId = params.get("v");
  const urlParam = params.get("url");

  // url 파라미터만 온 경우(예전 링크) -> ID 추출
  if (!videoId && urlParam) {
    try {
      const u = new URL(urlParam);
      if (u.hostname.includes("youtu.be")) {
        videoId = u.pathname.split("/").filter(Boolean)[0];
      } else {
        videoId = u.searchParams.get("v");
        if (!videoId) {
          const shorts = u.pathname.match(/\/shorts\/([a-zA-Z0-9_-]{11})/);
          if (shorts) videoId = shorts[1];
        }
      }
    } catch (e) {}
  }

  const start = Math.max(0, getInt(params.get("start"), 0));
  const end = Math.max(0, getInt(params.get("end"), 0));
  const rel = (params.get("rel") === "1") ? "1" : "0";

  const errEl = document.getElementById("err");
  const frame = document.getElementById("ytFrame");

  if (!videoId || !/^[a-zA-Z0-9_-]{11}$/.test(videoId)) {
    errEl.style.display = "block";
    errEl.innerHTML =
      "영상 정보가 없습니다.<br><br>" +
      "아래처럼 접속해야 합니다:<br>" +
      "<b>/youp.html?v=영상ID&start=0&end=0&rel=0</b><br><br>" +
      "예시:<br>" +
      `<a href="/youp.html?v=5wwRM3CWj-g&start=0&end=0&rel=0">/youp.html?v=5wwRM3CWj-g&start=0&end=0&rel=0</a>`;
    throw new Error("Invalid video id");
  }

  // end가 start보다 작거나 같으면 end는 무시
  const safeEnd = (end > start) ? end : 0;

  // embed URL 생성
  const embedParams = new URLSearchParams({
    autoplay: "1",
    rel: rel,
    start: String(start),
    playsinline: "1"
  });
  if (safeEnd) embedParams.set("end", String(safeEnd));

  frame.src = `https://www.youtube.com/embed/${videoId}?${embedParams.toString()}`;
</script>
</body>
</html>
